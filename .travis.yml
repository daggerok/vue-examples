jdk: oraclejdk8

language: node_js
node_js: lts/*

dist: xenial
notifications:
  email: false
git:
  quiet: true
  depth: 3

service:
  - xvfb

addons:
  apt:
    update: true
    packages:
    - bash
    - curl
    - fonts-liberation
    - libappindicator1
    - google-chrome-stable

install: true
before_install:
- export CHROME_BIN=/usr/bin/google-chrome
- export DISPLAY=:99.0
#
- curl -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add -
- echo "deb https://dl.yarnpkg.com/debian/ stable main" | sudo tee /etc/apt/sources.list.d/yarn.list
- sudo apt update -y || true
- sudo apt install --no-install-recommends -y yarn
#
- export root=$(pwd)

jobs:
  include:

  - stage: test
    node_js: lts/*
    name: vue-bootstrap-css
    script:
    - cd ${root}/vue-bootstrap-css
    - yarn -i
    - yarn predeploy

  - stage: test
    node_js: lts/*
    name: refs-work-natively-with-DOM-elements
    script:
    - cd ${root}/refs-work-natively-with-DOM-elements
    - yarn -i
    - yarn predeploy

  - stage: test
    node_js: lts/*
    name: eventbus
    script:
    - cd ${root}/eventbus
    - yarn -i
    - yarn predeploy

  - stage: test
    node_js: lts/*
    name: some-vuetify-app
    script:
    - cd ${root}/some-vuetify-app
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: vuetify
    script:
    - cd ${root}/vuetify
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: vuetifyjs-setup
    script:
    - cd ${root}/vuetifyjs-setup
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: firebase-using-vuefire
    script:
    - cd ${root}/firebase-using-vuefire
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: responsive-web-design
    script:
    - cd ${root}/responsive-web-design
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: nuxt-server-side-rendering
    script:
    - cd ${root}/nuxt-server-side-rendering
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: vuex-map-getters-and-map-actions
    script:
    - cd ${root}/vuex-map-getters-and-map-actions
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: vue-material
    script:
    - cd ${root}/vue-material
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: materialize-css
    script:
    - cd ${root}/materialize-css
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: vuex-contact-list
    script:
    - cd ${root}/vuex-contact-list
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: vuex-counter-todo
    script:
    - cd ${root}/vuex-counter-todo
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: hello-vuex
    script:
    - cd ${root}/hello-vuex
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: todo-list
    script:
    - cd ${root}/todo-list
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: hello-world
    script:
    - cd ${root}/hello-world
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: template
    script:
    - cd ${root}/template
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: 12-vuetifyjs-setup
    script:
    - cd ${root}/12-vuetifyjs-setup
    - cp firebase.js.default firebase.js || true
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: 11-firebase-using-vuefire
    script:
    - cd ${root}/11-firebase-using-vuefire
    - cp firebase.js.default firebase.js || true
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: 14-some-vuetify-app
    script:
    - cd ${root}/14-some-vuetify-app
    - cp firebase.config.js.default firebase.config.js || true
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: test
    node_js: lts/*
    name: 13-vuetify
    script:
    - cd ${root}/13-vuetify
    - cp firebase.config.js.default firebase.config.js || true
    - yarn install;
    - yarn predeploy;
    - if [ -f npm-debug.log ]; then cat npm-debug.log; fi;
    - yarn build --report

  - stage: deploy
    jdk: openjdk11
    name: GitHub release and GitHub pages deployment (openjdk11)
    env:
      global:
      - TERM=dumb
      - secure: g80MSLgxtVqyYayEga+2JMTg/2MdLxmcdqefk42scs8iPgnLVgkZKrRnlqVN5qDcrsnV558ehIOSypWX3xnFILOm3/DktqMJ0NJ1tCOiDdxbcYIlm3vE5Sn1zkSh2W2hzNqoYTRv1rrE2bMggLZIvzHZYPpvP5ugReIoZSxyu6Aj8gjYWoVWN7xI4QTcPnIxXlEDcRdqATJIdjNCFB0lNNJHmvNgy843eGKcwgrCrzLLzyCSIrB/VWfaqezvjPZMITVXl0ol0OmglIgmwFPLUTwDTOgv7lPGsfLz0jugi4z1dIpG4dR4bgMjX2WnUrpTPu/tkNMvOfWshoqbpYZRzSGRK81OuIDUwCRC48I4ErMzgukH5sX732nL1wWfQaYMmppLKLvADMdVBzPILd9Y06k8whH6SqxN+8AfF5UcyGMMYmRpTOqu1G94ppQLTS+KLkW6vi0PZDz4IydwkYSJthr2fKMngNXloN1e4CQVYR8TTkHFcK3AaNGi44sLIFtXmQ0q4U9SmJBO7O56l7JvzekLq1vPelwK9kC8Hz82jGk54pkRBIm8j7n166UC9nsb6nl7PKvpBnFj0bUQdTEV4LtWDMLLiurk/Y4ygzgq653wzDrR7x7hELgkD09/UxsuweTRpgkPFQFCzQKuHafs0KUqLEL3pdWnvyBxagsNzNU=
    script: skip
    if: branch = "master" AND type NOT IN (pull_request)
    before_deploy:
    - if [ "$TRAVIS_PULL_REQUEST" != "false" ] || [ ".$TRAVIS_BRANCH" != ".master" ] ; then exit 0 ; fi
    - env
    # publish tag release
    - mkdir -p ${HOME}/.m2
    - set -e
    before_deploy:
    - cd ${root}
    - ./mvnw -Pdocs
    deploy:
      provider: pages
      skip-cleanup: true
      # travis encrypt GITHUB_TOKEN=<your github repo token> --add
      github-token: "$GITHUB_TOKEN"
      keep-history: true
      on:
        branch: master
      local-dir: target/generated-docs
      target_branch: gh-pages

cache:
  npm: true
  yarn: true
  packages: true
  directories:
  - node_modules/
  - $HOME/.npm
